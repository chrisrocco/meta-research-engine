<?php

namespace Tests;
/**
 * Created by PhpStorm.
 * User: Caleb Falcione
 * Date: 5/9/2017
 * Time: 6:37 PM
 */

use Papers;

class EncodingTest  extends BaseTestCase {

    public function setUp () {
        $this->assignments = json_decode($this->assignments_json);
    }

    public function testSetUp() {
        self::assertTrue(is_array($this->assignments));
    }

    public function testAssignmentCreate() {
        //by extension, also tests the constructors for Encoding and ValueResponse
        foreach ($this->assignments as $assignment) {
            $assignment = new Papers\Assignment($assignment);
            $jsonOutput = json_encode($assignment);
            self::assertNotTrue(is_bool($jsonOutput));
//            echo $jsonOutput;
        }
    }

    public function testMasterEncodingMerge () {
        $masterEncoding = new Papers\MasterEncoding($this->examplePaperPMCID);
        foreach ($this->assignments as $assignment) {
            $masterEncoding->merge($assignment);
        }
        echo json_encode($masterEncoding);
    }


    protected $examplePaperPMCID = 3337602;
    protected $assignments_json = '[{"_key":"352","_id":"assignments/352","_rev":"_U3LmDG6--H","encoding":{"branches":[[]],"constants":[{"content":{"value":"prior to the experiment, mice were provided food and water ad libitum for three days"},"field":"acclimationPeriod"},{"content":{"value":0},"field":"acclimationDuration"},{"content":{"value":70},"field":"ageAtStart"},{"content":{},"field":"ageAtWeight"},{"content":{"value":"The Jackson Labaratory"},"field":"facilityName"},{"content":{"value":"Bar Harbor, ME"},"field":"facilityCityState"},{"content":{"value":"United States"},"field":"facilityCountry"},{"content":{"value":"field.falseOption"},"field":"animalLocations"},{"content":{"value":"Not germ free"},"field":"pathogenFreeEnvironment"},{"content":{"value":"Other","disabled":true},"field":"cageType"},{"content":{"value":"","disabled":true},"field":"airCirculation"},{"content":{"value":"","disabled":true},"field":"beddingMaterial"},{"content":{"value":"","disabled":true},"field":"changeFrequency"},{"content":{"value":"","disabled":true},"field":"enrichmentType"},{"content":{"value":"field.trueOption"},"field":"lightingSchedule"},{"content":{"value":"","disabled":true},"field":"lightHours"},{"content":{"value":"","disabled":true},"field":"darkHours"},{"content":{"value":"","disabled":true},"field":"lightStartTime"},{"content":{"value":"","disabled":true},"field":"facilityHumidity"},{"content":{"value":"","disabled":true},"field":"constantTemperature"},{"content":{"value":"","disabled":true},"field":"temperatureRange"},{"content":{"value":"","disabled":true},"field":"dietType"},{"content":{"value":"LabDiet 5001"},"field":"dietID"},{"content":{"value":"Purina Mills"},"field":"dietVendor"},{"content":{"value":"Gray Summit, MO"},"field":"dietVendorCity"},{"content":{"value":"Ad libitum"},"field":"feedingFrequency"},{"content":{"value":"","disabled":true},"field":"percentEnergy"},{"content":{"value":"","disabled":true},"field":"percentFat"},{"content":{"value":"","disabled":true},"field":"percentCarbohydrates"},{"content":{"value":"","disabled":true},"field":"percentProtein"},{"content":{"value":"","disabled":true},"field":"exerciseType"},{"content":{"value":"","disabled":true},"field":"exerciseFreq"},{"content":{"value":"","disabled":true},"field":"forcedExcecise"},{"content":{"value":28},"field":"daysOnTreatment"},{"content":{"value":"The Jackson Laboratory"},"field":"vendorName"},{"content":{"value":"","disabled":true},"field":"miceVendorCity"},{"content":{"value":"","disabled":true},"field":"vendorCountry"},{"content":{"value":"Male","disabled":true},"field":"sex"},{"content":{"value":"C57BL/6J"},"field":"breed"},{"content":{"value":"","disabled":true},"field":"surgeryType"},{"content":{"value":"","disabled":true},"field":"routeOfAdministration"},{"content":{"value":"","disabled":true},"field":"compoundName"},{"content":{"value":"","disabled":true},"field":"compoundFrequency"},{"content":{"value":"","disabled":true},"field":"dosage"},{"content":{"value":"","disabled":true},"field":"geneticManipulationType"},{"content":{"value":"field.trueOption"},"field":"ethicalStatement"},{"content":{"value":2},"field":"micePerCage"},{"content":{"value":"","disabled":true},"field":"sampleSize"},{"content":{"value":"","disabled":true},"field":"whereReported"},{"content":{"value":"","disabled":true},"field":"averageFinalWeight"},{"content":{"value":"","disabled":true},"field":"errorOfMeasurmentValue"},{"content":{"value":"","disabled":true},"field":"errorOfMeasurmentType"}]},"date_created":"2017-02-27 08:37:03","status":"active","completion":"100"},{"_key":"782","_id":"assignments/782","_rev":"_U3LmDLK--Q","encoding":{"branches":[[]],"constants":[{"content":{"value":""},"field":"acclimationPeriod"},{"content":{"value":""},"field":"acclimationDuration"},{"content":{"value":10},"field":"ageAtStart"},{"content":{"value":10},"field":"ageAtWeight"},{"content":{"value":"The Jackson Laboratory"},"field":"facilityName"},{"content":{"value":"Bar Harbor,ME"},"field":"facilityCityState"},{"content":{"value":"United States"},"field":"facilityCountry"},{"content":{"value":"field.falseOption"},"field":"animalLocations"},{"content":{"value":"Completely germ-free"},"field":"pathogenFreeEnvironment"},{"content":{"value":"Open cages"},"field":"cageType"},{"content":{"value":""},"field":"airCirculation"},{"content":{"value":""},"field":"beddingMaterial"},{"content":{"value":""},"field":"changeFrequency"},{"content":{"value":""},"field":"enrichmentType"},{"content":{"value":""},"field":"lightingSchedule"},{"content":{"value":""},"field":"lightHours"},{"content":{"value":""},"field":"darkHours"},{"content":{"value":""},"field":"lightStartTime"},{"content":{"value":""},"field":"facilityHumidity"},{"content":{"value":""},"field":"constantTemperature"},{"content":{"value":""},"field":"temperatureRange"},{"content":{"value":""},"field":"dietType"},{"content":{"value":"5001"},"field":"dietID"},{"content":{"value":"LabDiet"},"field":"dietVendor"},{"content":{"value":"Purina Mills,Gray Summit,MO"},"field":"dietVendorCity"},{"content":{"value":"Ad libitum"},"field":"feedingFrequency"},{"content":{"value":""},"field":"percentEnergy"},{"content":{"value":""},"field":"percentFat"},{"content":{"value":""},"field":"percentCarbohydrates"},{"content":{"value":""},"field":"percentProtein"},{"content":{"value":""},"field":"exerciseType"},{"content":{"value":""},"field":"exerciseFreq"},{"content":{"value":""},"field":"forcedExcecise"},{"content":{"value":""},"field":"daysOnTreatment"},{"content":{"value":""},"field":"vendorName"},{"content":{"value":""},"field":"miceVendorCity"},{"content":{"value":""},"field":"vendorCountry"},{"content":{"value":""},"field":"sex"},{"content":{"value":""},"field":"breed"},{"content":{"value":""},"field":"surgeryType"},{"content":{"value":""},"field":"routeOfAdministration"},{"content":{"value":""},"field":"compoundName"},{"content":{"value":""},"field":"compoundFrequency"},{"content":{"value":""},"field":"dosage"},{"content":{"value":""},"field":"geneticManipulationType"},{"content":{"value":""},"field":"ethicalStatement"},{"content":{"value":""},"field":"micePerCage"},{"content":{"value":""},"field":"sampleSize"},{"content":{"value":""},"field":"whereReported"},{"content":{"value":""},"field":"averageFinalWeight"},{"content":{"value":""},"field":"errorOfMeasurmentValue"},{"content":{"value":""},"field":"errorOfMeasurmentType"}]},"date_created":"2017-03-06 10:43:37","status":"active","completion":"11"},{"_key":"281","_id":"assignments/281","_rev":"_U3LmDL---O","encoding":{"branches":[[]],"constants":[{"content":{"value":"After three days of cage acclimation, unanesthetized mice (4 per exposure) were irradiated (IR; JL Shepherd Mark I, 137Cs gamma ray source, San Gabriel, CA) with 1, 10, or 100â€‰cGy at 0.96, 0.96, or 88â€‰cGy/min (Â±10%), respectively, or were sham-irradiated (0â€‰cGy-controls)."},"field":"acclimationPeriod"},{"content":{"value":4},"field":"acclimationDuration"},{"content":{"value":3},"field":"ageAtStart"},{"content":{"value":5},"field":"ageAtWeight"},{"content":{"value":"","disabled":true},"field":"facilityName"},{"content":{"value":"Moffett fields, California and Irvine, California"},"field":"facilityCityState"},{"content":{"value":"United States"},"field":"facilityCountry"},{"content":{"value":"field.trueOption"},"field":"animalLocations"},{"content":{"value":"Completely germ-free"},"field":"pathogenFreeEnvironment"},{"content":{"value":"Open cages"},"field":"cageType"},{"content":{"value":"Open cages"},"field":"airCirculation"},{"content":{"value":"","disabled":true},"field":"beddingMaterial"},{"content":{"value":"","disabled":true},"field":"changeFrequency"},{"content":{"value":"","disabled":true},"field":"enrichmentType"},{"content":{"value":"field.falseOption"},"field":"lightingSchedule"},{"content":{"value":2},"field":"lightHours"},{"content":{"value":5},"field":"darkHours"},{"content":{"value":10},"field":"lightStartTime"},{"content":{"upperValue":75,"value":"","lowerValue":38},"field":"facilityHumidity"},{"content":{"value":"field.trueOption"},"field":"constantTemperature"},{"content":{"upperValue":46,"value":"","lowerValue":0},"field":"temperatureRange"},{"content":{"value":"Food and water ad lubitium"},"field":"dietType"},{"content":{"value":"C57BL/6J"},"field":"dietID"},{"content":{"value":"NASA"},"field":"dietVendor"},{"content":{"value":"Moffet Field, CA and Irvine, CA"},"field":"dietVendorCity"},{"content":{"value":"Ad libitum"},"field":"feedingFrequency"},{"content":{"value":"field.falseOption"},"field":"percentEnergy"},{"content":{"value":25},"field":"percentFat"},{"content":{"value":45},"field":"percentCarbohydrates"},{"content":{"value":30},"field":"percentProtein"},{"content":{"value":"","disabled":true},"field":"exerciseType"},{"content":{"value":"Weekly"},"field":"exerciseFreq"},{"content":{"value":"field.falseOption"},"field":"forcedExcecise"},{"content":{},"field":"daysOnTreatment"},{"content":{"value":"NASA"},"field":"vendorName"},{"content":{"value":"Moffett Field, CA and Irvine, CA"},"field":"miceVendorCity"},{"content":{"value":"United States"},"field":"vendorCountry"},{"content":{"value":"Male"},"field":"sex"},{"content":{"value":"C57BL/6J"},"field":"breed"},{"content":{"value":"Gastric bypass"},"field":"surgeryType"},{"content":{"value":"Food"},"field":"routeOfAdministration"},{"content":{"value":"Sucrose"},"field":"compoundName"},{"content":{"value":"Weekly"},"field":"compoundFrequency"},{"content":{"value":"200IU"},"field":"dosage"},{"content":{"value":"They were given osteoporosis"},"field":"geneticManipulationType"},{"content":{"value":"field.falseOption"},"field":"ethicalStatement"},{"content":{"value":2},"field":"micePerCage"},{"content":{"value":5},"field":"sampleSize"},{"content":{"value":"Text, with numbers reported"},"field":"whereReported"},{"content":{"value":30},"field":"averageFinalWeight"},{"content":{},"field":"errorOfMeasurmentValue"},{"content":{"value":"Standard Deviation (S.D. or s.d.)"},"field":"errorOfMeasurmentType"}]},"date_created":"2017-02-24 22:31:42","status":"active","completion":"100"},{"_key":"531","_id":"assignments/531","_rev":"_U3LmDKi--I","encoding":{"branches":[[]],"constants":[{"content":{"value":"Mice were provided food (LabDiet 5001, Purina Mills, Gray Summit, MO) and water ad libitum."},"field":"acclimationPeriod"},{"content":{"value":16},"field":"acclimationDuration"},{"content":{"value":10},"field":"ageAtStart"},{"content":{"value":27},"field":"ageAtWeight"},{"content":{"value":"The Jackson Laboratory"},"field":"facilityName"},{"content":{"value":"Bar Harbor, ME"},"field":"facilityCityState"},{"content":{"value":"USA"},"field":"facilityCountry"},{"content":{"value":"field.falseOption"},"field":"animalLocations"},{"content":{"value":"","disabled":true},"field":"pathogenFreeEnvironment"},{"content":{"value":"","disabled":true},"field":"cageType"},{"content":{"value":"","disabled":true},"field":"airCirculation"},{"content":{"value":"","disabled":true},"field":"beddingMaterial"},{"content":{"value":"","disabled":true},"field":"changeFrequency"},{"content":{"value":"","disabled":true},"field":"enrichmentType"},{"content":{"value":"","disabled":true},"field":"lightingSchedule"},{"content":{"value":"","disabled":true},"field":"lightHours"},{"content":{"value":"","disabled":true},"field":"darkHours"},{"content":{"value":"","disabled":true},"field":"lightStartTime"},{"content":{"value":"","disabled":true},"field":"facilityHumidity"},{"content":{"value":"","disabled":true},"field":"constantTemperature"},{"content":{"value":"","disabled":true},"field":"temperatureRange"},{"content":{"value":"Lab diet"},"field":"dietType"},{"content":{"value":"5001"},"field":"dietID"},{"content":{"value":"Purina Mills, Gray Summit, MO"},"field":"dietVendor"},{"content":{"value":"Gray Summit, MO"},"field":"dietVendorCity"},{"content":{"value":"","disabled":true},"field":"feedingFrequency"},{"content":{"value":"","disabled":true},"field":"percentEnergy"},{"content":{"value":"","disabled":true},"field":"percentFat"},{"content":{"value":"","disabled":true},"field":"percentCarbohydrates"},{"content":{"value":"","disabled":true},"field":"percentProtein"},{"content":{"value":"","disabled":true},"field":"exerciseType"},{"content":{"value":"","disabled":true},"field":"exerciseFreq"},{"content":{"value":"","disabled":true},"field":"forcedExcecise"},{"content":{"value":"","disabled":true},"field":"daysOnTreatment"},{"content":{"value":"","disabled":true},"field":"vendorName"},{"content":{"value":"","disabled":true},"field":"miceVendorCity"},{"content":{"value":"","disabled":true},"field":"vendorCountry"},{"content":{"value":"Male"},"field":"sex"},{"content":{"value":"C57BL/6J"},"field":"breed"},{"content":{"value":"Tissues were harvested on the day of IR (basal) or 1 or 4 months later (n = 8/group), with cell culture being performed at the latter two endpoints."},"field":"surgeryType"},{"content":{"value":"Topically (on the bodys surface"},"field":"routeOfAdministration"},{"content":{"value":"(IR; JL Shepherd Mark I, 137Cs"},"field":"compoundName"},{"content":{"value":"","disabled":true},"field":"compoundFrequency"},{"content":{"value":"","disabled":true},"field":"dosage"},{"content":{"value":"","disabled":true},"field":"geneticManipulationType"},{"content":{"value":"field.trueOption"},"field":"ethicalStatement"},{"content":{"value":2},"field":"micePerCage"},{"content":{"value":8},"field":"sampleSize"},{"content":{"value":"Text, with numbers reported"},"field":"whereReported"},{"content":{"value":30},"field":"averageFinalWeight"},{"content":{"value":10},"field":"errorOfMeasurmentValue"},{"content":{"value":"","disabled":true},"field":"errorOfMeasurmentType"}]},"date_created":"2017-03-06 08:17:29","status":"active","completion":"100"},{"_key":"363","_id":"assignments/363","_rev":"_U3LmDLK--O","encoding":{"branches":[[]],"constants":[{"content":{"value":"Mice were irradiated and tissues were harvested on the day of irradiation."},"field":"acclimationPeriod"},{"content":{"value":12},"field":"acclimationDuration"},{"content":{"value":70,"disabled":false},"field":"ageAtStart"},{"content":{"value":189},"field":"ageAtWeight"},{"content":{"value":"The Jackson Laboratory"},"field":"facilityName"},{"content":{"value":"Bar Harbor, ME"},"field":"facilityCityState"},{"content":{"value":"USA"},"field":"facilityCountry"},{"content":{"value":"field.falseOption"},"field":"animalLocations"},{"content":{"value":""},"field":"pathogenFreeEnvironment"},{"content":{"value":""},"field":"cageType"},{"content":{"value":""},"field":"airCirculation"},{"content":{"value":""},"field":"beddingMaterial"},{"content":{"value":""},"field":"changeFrequency"},{"content":{"value":""},"field":"enrichmentType"},{"content":{"value":""},"field":"lightingSchedule"},{"content":{"value":""},"field":"lightHours"},{"content":{"value":""},"field":"darkHours"},{"content":{"value":""},"field":"lightStartTime"},{"content":{"value":""},"field":"facilityHumidity"},{"content":{"value":""},"field":"constantTemperature"},{"content":{"value":""},"field":"temperatureRange"},{"content":{"value":"LabDiet 5001, Purina Mills, Gray Summit, MO"},"field":"dietType"},{"content":{"value":"LabDiet 5001"},"field":"dietID"},{"content":{"value":"Purina Mills"},"field":"dietVendor"},{"content":{"value":"Gray Summit, MO"},"field":"dietVendorCity"},{"content":{"value":"Ad libitum"},"field":"feedingFrequency"},{"content":{"value":""},"field":"percentEnergy"},{"content":{"value":""},"field":"percentFat"},{"content":{"value":""},"field":"percentCarbohydrates"},{"content":{"value":""},"field":"percentProtein"},{"content":{"value":""},"field":"exerciseType"},{"content":{"value":""},"field":"exerciseFreq"},{"content":{"value":"field.falseOption"},"field":"forcedExcecise"},{"content":{"value":""},"field":"daysOnTreatment"},{"content":{"value":"The Jackson Laboratory"},"field":"vendorName"},{"content":{"value":"Bar Harbor, ME"},"field":"miceVendorCity"},{"content":{"value":"USA"},"field":"vendorCountry"},{"content":{"value":"Male"},"field":"sex"},{"content":{"value":""},"field":"breed"},{"content":{"value":""},"field":"surgeryType"},{"content":{"value":""},"field":"routeOfAdministration"},{"content":{"value":""},"field":"compoundName"},{"content":{"value":""},"field":"compoundFrequency"},{"content":{"value":""},"field":"dosage"},{"content":{"value":""},"field":"geneticManipulationType"},{"content":{"value":""},"field":"ethicalStatement"},{"content":{"value":4},"field":"micePerCage"},{"content":{"value":4},"field":"sampleSize"},{"content":{"value":"In a figure"},"field":"whereReported"},{"content":{},"field":"averageFinalWeight"},{"content":{"value":"","disabled":false},"field":"errorOfMeasurmentValue"},{"content":{"value":""},"field":"errorOfMeasurmentType"}]},"date_created":"2017-02-28 08:51:35","status":"active","completion":"100"}]';
    protected $assignments;
}